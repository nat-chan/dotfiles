# chpwd               „Ç´„É¨„É≥„Éà„Éá„Ç£„É¨„ÇØ„Éà„É™„ÅåÂ§âÊõ¥„Åó„Åü„Å®„Åç
# periodic            „Éó„É≠„É≥„Éó„Éà„ÇíË°®Á§∫„Åô„Çã„Åü„Å≥„Å´„ÄÅ$PERIODÁßí„Åî„Å®
# precmd              „Éó„É≠„É≥„Éó„Éà„ÇíË°®Á§∫„Åô„ÇãÁõ¥Ââç
# preexec             Enter„ÇíÊäº„Åó„Å¶„Ç≥„Éû„É≥„Éâ„ÇíÂÆüË°å„Åô„ÇãÁõ¥Ââç
# zshaddhistory       „Ç≥„Éû„É≥„Éâ„É©„Ç§„É≥„Åå„Éí„Çπ„Éà„É™„Å´ËøΩÂä†„Åï„Çå„ÇãÁõ¥Ââç
# zshexit             zsh„ÇíÁµÇ‰∫Ü„Åô„ÇãÁõ¥Ââç
# zsh_directory_name  Dynamic named directories„Å´„Çà„Çã„Éá„Ç£„É¨„ÇØ„Éà„É™ÂêçÂ§âÊèõ
#
# PROMPT„Å´[32m„ÇíÊ∑∑„Åú„Çã„Å®tabË£úÂÆå„ÅßÂ¥©„Çå„Çã

pmodload 'helper'

function prompt_N_precmd {
  local EXIT_CODE=$?
  vcs_info
  _pwd=$(prompt-pwd)
  local block="\
‚†Ä‚¢Ä‚††‚¢†‚†ê‚¢ê‚†∞‚¢∞‚†à‚¢à‚†®‚¢®‚†ò‚¢ò‚†∏‚¢∏‚°Ä‚£Ä‚°†‚£†‚°ê‚£ê‚°∞‚£∞‚°à‚£à‚°®‚£®‚°ò‚£ò‚°∏‚£∏‚†Ñ‚¢Ñ‚†§‚¢§‚†î‚¢î‚†¥‚¢¥‚†å‚¢å‚†¨‚¢¨‚†ú‚¢ú‚†º‚¢º‚°Ñ‚£Ñ‚°§‚£§‚°î‚£î‚°¥‚£¥‚°å‚£å‚°¨‚£¨‚°ú‚£ú‚°º‚£º\
‚†Ç‚¢Ç‚†¢‚¢¢‚†í‚¢í‚†≤‚¢≤‚†ä‚¢ä‚†™‚¢™‚†ö‚¢ö‚†∫‚¢∫‚°Ç‚£Ç‚°¢‚£¢‚°í‚£í‚°≤‚£≤‚°ä‚£ä‚°™‚£™‚°ö‚£ö‚°∫‚£∫‚†Ü‚¢Ü‚†¶‚¢¶‚†ñ‚¢ñ‚†∂‚¢∂‚†é‚¢é‚†Æ‚¢Æ‚†û‚¢û‚†æ‚¢æ‚°Ü‚£Ü‚°¶‚£¶‚°ñ‚£ñ‚°∂‚£∂‚°é‚£é‚°Æ‚£Æ‚°û‚£û‚°æ‚£æ\
‚†Å‚¢Å‚†°‚¢°‚†ë‚¢ë‚†±‚¢±‚†â‚¢â‚†©‚¢©‚†ô‚¢ô‚†π‚¢π‚°Å‚£Å‚°°‚£°‚°ë‚£ë‚°±‚£±‚°â‚£â‚°©‚£©‚°ô‚£ô‚°π‚£π‚†Ö‚¢Ö‚†•‚¢•‚†ï‚¢ï‚†µ‚¢µ‚†ç‚¢ç‚†≠‚¢≠‚†ù‚¢ù‚†Ω‚¢Ω‚°Ö‚£Ö‚°•‚£•‚°ï‚£ï‚°µ‚£µ‚°ç‚£ç‚°≠‚£≠‚°ù‚£ù‚°Ω‚£Ω\
‚†É‚¢É‚†£‚¢£‚†ì‚¢ì‚†≥‚¢≥‚†ã‚¢ã‚†´‚¢´‚†õ‚¢õ‚†ª‚¢ª‚°É‚£É‚°£‚££‚°ì‚£ì‚°≥‚£≥‚°ã‚£ã‚°´‚£´‚°õ‚£õ‚°ª‚£ª‚†á‚¢á‚†ß‚¢ß‚†ó‚¢ó‚†∑‚¢∑‚†è‚¢è‚†Ø‚¢Ø‚†ü‚¢ü‚†ø‚¢ø‚°á‚£á‚°ß‚£ß‚°ó‚£ó‚°∑‚£∑‚°è‚£è‚°Ø‚£Ø‚°ü‚£ü‚°ø‚£ø\
"
	if [[ $EXIT_CODE -ne 0 ]]; then
		ec="%F{red}$block[$((EXIT_CODE+1))]%f"
	else
		if [ "$TMUX" = "" ]; then
			ec="%F{cyan}¬´%f"
		else
			ec="%F{cyan}¬ª%f"
		fi
	fi
	
}

function +vi-git_status {
  # Check for untracked files or updated submodules since vcs_info does not.
  if [[ -n $(git ls-files --other --exclude-standard 2> /dev/null) ]]; then
    hook_com[unstaged]='%F{red}¬∂%f'
  fi
}

function exit_code() {
  local EXIT_CODE=$?
block="\
‚†Ä‚¢Ä‚††‚¢†‚†ê‚¢ê‚†∞‚¢∞‚†à‚¢à‚†®‚¢®‚†ò‚¢ò‚†∏‚¢∏‚°Ä‚£Ä‚°†‚£†‚°ê‚£ê‚°∞‚£∞‚°à‚£à‚°®‚£®‚°ò‚£ò‚°∏‚£∏‚†Ñ‚¢Ñ‚†§‚¢§‚†î‚¢î‚†¥‚¢¥‚†å‚¢å‚†¨‚¢¨‚†ú‚¢ú‚†º‚¢º‚°Ñ‚£Ñ‚°§‚£§‚°î‚£î‚°¥‚£¥‚°å‚£å‚°¨‚£¨‚°ú‚£ú‚°º‚£º\
‚†Ç‚¢Ç‚†¢‚¢¢‚†í‚¢í‚†≤‚¢≤‚†ä‚¢ä‚†™‚¢™‚†ö‚¢ö‚†∫‚¢∫‚°Ç‚£Ç‚°¢‚£¢‚°í‚£í‚°≤‚£≤‚°ä‚£ä‚°™‚£™‚°ö‚£ö‚°∫‚£∫‚†Ü‚¢Ü‚†¶‚¢¶‚†ñ‚¢ñ‚†∂‚¢∂‚†é‚¢é‚†Æ‚¢Æ‚†û‚¢û‚†æ‚¢æ‚°Ü‚£Ü‚°¶‚£¶‚°ñ‚£ñ‚°∂‚£∂‚°é‚£é‚°Æ‚£Æ‚°û‚£û‚°æ‚£æ\
‚†Å‚¢Å‚†°‚¢°‚†ë‚¢ë‚†±‚¢±‚†â‚¢â‚†©‚¢©‚†ô‚¢ô‚†π‚¢π‚°Å‚£Å‚°°‚£°‚°ë‚£ë‚°±‚£±‚°â‚£â‚°©‚£©‚°ô‚£ô‚°π‚£π‚†Ö‚¢Ö‚†•‚¢•‚†ï‚¢ï‚†µ‚¢µ‚†ç‚¢ç‚†≠‚¢≠‚†ù‚¢ù‚†Ω‚¢Ω‚°Ö‚£Ö‚°•‚£•‚°ï‚£ï‚°µ‚£µ‚°ç‚£ç‚°≠‚£≠‚°ù‚£ù‚°Ω‚£Ω\
‚†É‚¢É‚†£‚¢£‚†ì‚¢ì‚†≥‚¢≥‚†ã‚¢ã‚†´‚¢´‚†õ‚¢õ‚†ª‚¢ª‚°É‚£É‚°£‚££‚°ì‚£ì‚°≥‚£≥‚°ã‚£ã‚°´‚£´‚°õ‚£õ‚°ª‚£ª‚†á‚¢á‚†ß‚¢ß‚†ó‚¢ó‚†∑‚¢∑‚†è‚¢è‚†Ø‚¢Ø‚†ü‚¢ü‚†ø‚¢ø‚°á‚£á‚°ß‚£ß‚°ó‚£ó‚°∑‚£∑‚°è‚£è‚°Ø‚£Ø‚°ü‚£ü‚°ø‚£ø\
"
	if [[ $EXIT_CODE -ne 0 ]]; then
		echo -ne "\e[31m$block[$((EXIT_CODE+1))]\e[0m"
	else
		echo -ne "\e[32m¬ª\e[0m"
	fi
}

function prompt_N_setup {
  setopt LOCAL_OPTIONS
  unsetopt XTRACE KSH_ARRAYS
  prompt_opts=(cr percent subst)

  # Load required functions.
  autoload -Uz add-zsh-hook
  autoload -Uz vcs_info

  # Add hook for calling vcs_info before each command.
  add-zsh-hook precmd prompt_N_precmd

  # Set vcs_info parameters.
  zstyle ':vcs_info:*' enable bzr git hg svn
  zstyle ':vcs_info:*' check-for-changes true
  zstyle ':vcs_info:*' stagedstr '%F{green}¬∂%f' #commit„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Éï„Ç°„Ç§„É´„Åå„ÅÇ„Çã
  zstyle ':vcs_info:*' unstagedstr '%F{yellow}¬∂%f' #add„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Éï„Ç°„Ç§„É´„Åå„ÅÇ„Çã
  zstyle ':vcs_info:*' formats ' [%b%c%u]'
  zstyle ':vcs_info:*' actionformats " [%b%c%u|%F{cyan}%a%f]"
  zstyle ':vcs_info:(sv[nk]|bzr):*' branchformat '%b|%F{cyan}%r%f'
  zstyle ':vcs_info:git*+set-message:*' hooks git_status

  #%(x.true-text.false-text)
  # Define prompts.
  PROMPT='${_pwd}${vcs_info_msg_0_} ${_tmux}${ec} %(1j.%j .)'
  RPROMPT=''
}

function prompt_N_preview {
	echo "preview is undefined"
}

#{{{ old
function old {
	setopt transient_rprompt
	typeset -A pc
	pc=(abelia 211 borage 39 crocus 57 dahlia 202 pentas-compf 202)

	local pcname=`hostname|sed -e 's/\.coins\.tsukuba\.ac\.jp//'`
	local pcnum=`echo $pcname|sed -e 's/abelia//'\
	                              -e 's/borage//'\
	                              -e 's/dahlia//'\
	                              -e 's/crocus//'`
	local flower=`echo $pcname|sed -e "s/$pcnum//"`

	local pcid=`echo -ne "%{\033[38;5;$pc[$flower]m%}$pcnum"`

	if [ "$TMUX" = "" ];then
		local tmux="<"
	else
		local tmux=">"
	fi

	local ret_status="%(?:%{$fg_bold[green]%}$tmux:%{$fg_bold[red]%}$tmux)"

	PROMPT='${ret_status} $pcid %{$fg[cyan]%}%c%{$reset_color%} '
	RPROMPT='$(git_prompt_info)'

	ZSH_THEME_GIT_PROMPT_PREFIX="%{$fg_bold[blue]%}git:(%{$fg[red]%}"
	ZSH_THEME_GIT_PROMPT_SUFFIX="%{$reset_color%} "
	ZSH_THEME_GIT_PROMPT_DIRTY="%{$fg[blue]%}) %{$fg[yellow]%}‚úó"
	ZSH_THEME_GIT_PROMPT_CLEAN="%{$fg[blue]%})"
}
#}}}

prompt_N_setup "$@"
